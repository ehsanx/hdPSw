<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>High dimensional propensity score - Appendix H — Creating hdPS variables from NHANES</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./labModified.html" rel="next">
<link href="./merge13to17.html" rel="prev">
<link href="./cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="twitter:title" content="High dimensional propensity score - Appendix H — Creating hdPS variables from NHANES">
<meta name="twitter:description" content="If there were more dimensions, separate list of candidate empirical covariates would be identified.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Appendix H — Creating hdPS variables from NHANES</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">High dimensional propensity score</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/ehsanx/hdPSw" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Download" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-download"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./High-dimensional-propensity-score.pdf">
            <i class="bi bi-bi-file-pdf pe-1"></i>
          Download PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./High-dimensional-propensity-score.epub">
            <i class="bi bi-bi-journal pe-1"></i>
          Download ePub
          </a>
        </li>
    </ul>
    <a href="" title="Share" id="sidebar-tool-dropdown-1" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-1">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./summary.html" class="sidebar-item-text sidebar-link">Summary</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./obj.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Objectives</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./NHANES.html" class="sidebar-item-text sidebar-link">NHANES</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index13.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Downloading NHANES 2013-14 cycle components</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index15.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Downloading NHANES 2015-16 cycle components</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index17.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Downloading NHANES 2017-18 cycle components</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analytic13.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Creating analytic dataset from 2013-14 cycle</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analytic15.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Creating analytic dataset from 2015-16 cycle</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analytic17.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Creating analytic dataset from 2017-18 cycle</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./merge13to17.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Merge NHANES 2013-2018 datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hdPSinMerged.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Creating hdPS variables from NHANES</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./labModified.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Preparing data with modified Lab variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./plasmode.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Plasmode Simulation</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resources.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Resources</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#determine-data-sources" id="toc-determine-data-sources" class="nav-link active" data-scroll-target="#determine-data-sources"><span class="toc-section-number">H.1</span>  Determine data sources</a>
  <ul class="collapse">
  <li><a href="#analytic-data" id="toc-analytic-data" class="nav-link" data-scroll-target="#analytic-data"><span class="toc-section-number">H.1.1</span>  Analytic data</a></li>
  <li><a href="#proxy-data" id="toc-proxy-data" class="nav-link" data-scroll-target="#proxy-data"><span class="toc-section-number">H.1.2</span>  Proxy data</a></li>
  <li><a href="#merge-analytic-data-and-proxies" id="toc-merge-analytic-data-and-proxies" class="nav-link" data-scroll-target="#merge-analytic-data-and-proxies"><span class="toc-section-number">H.1.3</span>  Merge analytic data and proxies</a></li>
  </ul></li>
  <li><a href="#identifying-candidate-empirical-covariates" id="toc-identifying-candidate-empirical-covariates" class="nav-link" data-scroll-target="#identifying-candidate-empirical-covariates"><span class="toc-section-number">H.2</span>  Identifying candidate empirical covariates</a></li>
  <li><a href="#assessing-recurrence-via-3-binary-variables" id="toc-assessing-recurrence-via-3-binary-variables" class="nav-link" data-scroll-target="#assessing-recurrence-via-3-binary-variables"><span class="toc-section-number">H.3</span>  Assessing recurrence via 3 binary variables</a></li>
  <li><a href="#prioritising-covariates" id="toc-prioritising-covariates" class="nav-link" data-scroll-target="#prioritising-covariates"><span class="toc-section-number">H.4</span>  Prioritising covariates</a>
  <ul class="collapse">
  <li><a href="#bross-formula" id="toc-bross-formula" class="nav-link" data-scroll-target="#bross-formula"><span class="toc-section-number">H.4.1</span>  Bross formula</a></li>
  <li><a href="#investigate-log-absolute-bias" id="toc-investigate-log-absolute-bias" class="nav-link" data-scroll-target="#investigate-log-absolute-bias"><span class="toc-section-number">H.4.2</span>  Investigate log-absolute-bias</a></li>
  </ul></li>
  <li><a href="#save-all-data" id="toc-save-all-data" class="nav-link" data-scroll-target="#save-all-data"><span class="toc-section-number">H.5</span>  Save all data</a>
  <ul class="collapse">
  <li><a href="#analytic-data-1" id="toc-analytic-data-1" class="nav-link" data-scroll-target="#analytic-data-1"><span class="toc-section-number">H.5.1</span>  Analytic data</a></li>
  <li><a href="#data-with-empirical-covariates" id="toc-data-with-empirical-covariates" class="nav-link" data-scroll-target="#data-with-empirical-covariates"><span class="toc-section-number">H.5.2</span>  Data with empirical covariates</a></li>
  <li><a href="#data-with-hdps-covariates" id="toc-data-with-hdps-covariates" class="nav-link" data-scroll-target="#data-with-hdps-covariates"><span class="toc-section-number">H.5.3</span>  Data with hdPS covariates</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/ehsanx/hdPSw/edit/main/hdPSinMerged.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Appendix H — Creating hdPS variables from NHANES</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="determine-data-sources" class="level2" data-number="H.1">
<h2 data-number="H.1" class="anchored" data-anchor-id="determine-data-sources"><span class="header-section-number">H.1</span> Determine data sources</h2>
<section id="analytic-data" class="level3" data-number="H.1.1">
<h3 data-number="H.1.1" class="anchored" data-anchor-id="analytic-data"><span class="header-section-number">H.1.1</span> Analytic data</h3>
<p>Even though the original algorithm was proposed for health care utilization or claims databases, in the current example, we will be relying on openly available NHANES data.</p>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-1_feee383a77177414edaacdfc893bc10c">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"data/analytic3cycles.RData"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>()</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "dat.mortality"  "dat.proxy.long" "data.complete"  "data.imputed"  </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] "data.merged"    "data.merged.xy"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proxy-data" class="level3" data-number="H.1.2">
<h3 data-number="H.1.2" class="anchored" data-anchor-id="proxy-data"><span class="header-section-number">H.1.2</span> Proxy data</h3>
<p>The Prescription Medications component of NHANES provides personal interview data on use of prescription medications during a one-month period prior (past 30 days) to the participant’s interview date.</p>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-2_6466ad912a975491f29c87074c3a85dc">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>analytic <span class="ot">&lt;-</span> data.imputed</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data.complete, data.imputed, data.merged, data.merged.xy)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>proxy.var.long <span class="ot">&lt;-</span> dat.proxy.long</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dat.proxy.long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merge-analytic-data-and-proxies" class="level3" data-number="H.1.3">
<h3 data-number="H.1.3" class="anchored" data-anchor-id="merge-analytic-data-and-proxies"><span class="header-section-number">H.1.3</span> Merge analytic data and proxies</h3>
<ol type="1">
<li>Prepare the minimal analytic data only with the following 4 information:</li>
</ol>
<ul>
<li>identifying information (<code>idx</code>)</li>
<li>exposure (<code>obese</code>)</li>
<li>outcome (<code>diabetes</code>)</li>
<li>domain of the codes (<code>dx</code>)</li>
</ul>
<p>In this example we only have prescription domain (1 domain <code>dx</code>)</p>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-3_bd185176c245e054606382b33deec9f8">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> analytic<span class="sc">$</span>id</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(analytic<span class="sc">$</span>diabetes <span class="sc">==</span> <span class="st">"Yes"</span>) </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>exposure <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(analytic<span class="sc">$</span>obese <span class="sc">==</span> <span class="st">"Yes"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>domain <span class="ot">&lt;-</span> <span class="st">"dx"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>analytic.dfx <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(idx, exposure, outcome, domain))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(analytic.dfx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["idx"],"name":[1],"type":["chr"],"align":["left"]},{"label":["exposure"],"name":[2],"type":["chr"],"align":["left"]},{"label":["outcome"],"name":[3],"type":["chr"],"align":["left"]},{"label":["domain"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"73557","2":"0","3":"1","4":"dx","_rn_":"1"},{"1":"73558","2":"0","3":"1","4":"dx","_rn_":"2"},{"1":"73559","2":"0","3":"1","4":"dx","_rn_":"3"},{"1":"73561","2":"0","3":"0","4":"dx","_rn_":"4"},{"1":"73562","2":"1","3":"0","4":"dx","_rn_":"5"},{"1":"73564","2":"1","3":"0","4":"dx","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(analytic.dfx)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 16091     4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>In the proxy data (from prescription domain), make sure the IDs have same name (<code>idx</code>) as the minimal analytic data:</li>
</ol>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-4_618e2edce7e7f68c23d60a2eba37fb26">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>proxy.var.long<span class="sc">$</span>idx <span class="ot">&lt;-</span> proxy.var.long<span class="sc">$</span>id</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(proxy.var.long<span class="sc">$</span>icd10), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  I10  E78  J45  F32  F41  K21  M79  M54  E03  G47 </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7302 3674 1495 1483 1439 1233 1156 1050 1017  964</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(proxy.var.long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["icd10"],"name":[2],"type":["chr"],"align":["left"]},{"label":["idx"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"73558","2":"G25","3":"73558","_rn_":"3"},{"1":"73558","2":"E78","3":"73558","_rn_":"6"},{"1":"73559","2":"K86","3":"73559","_rn_":"9"},{"1":"73559","2":"E78","3":"73559","_rn_":"10"},{"1":"73559","2":"I10","3":"73559","_rn_":"11"},{"1":"73561","2":"I10","3":"73561","_rn_":"14"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>proxy.var.long<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Merge both datasets</li>
</ol>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-5_0b796c1a7d99128cdd99a01836ec80e8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dfx <span class="ot">&lt;-</span> <span class="fu">merge</span>(analytic.dfx, proxy.var.long, <span class="at">by =</span> <span class="st">"idx"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dfx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["idx"],"name":[1],"type":["chr"],"align":["left"]},{"label":["exposure"],"name":[2],"type":["chr"],"align":["left"]},{"label":["outcome"],"name":[3],"type":["chr"],"align":["left"]},{"label":["domain"],"name":[4],"type":["chr"],"align":["left"]},{"label":["icd10"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"100001","2":"1","3":"0","4":"dx","5":"M79","_rn_":"1"},{"1":"100001","2":"1","3":"0","4":"dx","5":"K21","_rn_":"2"},{"1":"100001","2":"1","3":"0","4":"dx","5":"F33","_rn_":"3"},{"1":"100001","2":"1","3":"0","4":"dx","5":"M79","_rn_":"4"},{"1":"100001","2":"1","3":"0","4":"dx","5":"I10","_rn_":"5"},{"1":"100001","2":"1","3":"0","4":"dx","5":"F32","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(dfx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["idx"],"name":[1],"type":["chr"],"align":["left"]},{"label":["exposure"],"name":[2],"type":["chr"],"align":["left"]},{"label":["outcome"],"name":[3],"type":["chr"],"align":["left"]},{"label":["domain"],"name":[4],"type":["chr"],"align":["left"]},{"label":["icd10"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"99997","2":"0","3":"0","4":"dx","5":"K21","_rn_":"33880"},{"1":"99997","2":"0","3":"0","4":"dx","5":"I99","_rn_":"33881"},{"1":"99997","2":"0","3":"0","4":"dx","5":"I51","_rn_":"33882"},{"1":"99997","2":"0","3":"0","4":"dx","5":"I10","_rn_":"33883"},{"1":"99997","2":"0","3":"0","4":"dx","5":"I21","_rn_":"33884"},{"1":"99997","2":"0","3":"0","4":"dx","5":"K59","_rn_":"33885"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dfx)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 33885     5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="identifying-candidate-empirical-covariates" class="level2" data-number="H.2">
<h2 data-number="H.2" class="anchored" data-anchor-id="identifying-candidate-empirical-covariates"><span class="header-section-number">H.2</span> Identifying candidate empirical covariates</h2>
<ol type="1">
<li>Now, based on the merged dataset, we want to identify which patients were linked in both databases</li>
</ol>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-6_f5d891e3bca986980e3ba01cbb040c23">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#select distinct elements that are unique for each patient - treatment and outcome</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>basetable <span class="ot">&lt;-</span> dfx <span class="sc">%&gt;%</span> <span class="fu">select</span>(idx, exposure, outcome) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(basetable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["idx"],"name":[1],"type":["chr"],"align":["left"]},{"label":["exposure"],"name":[2],"type":["chr"],"align":["left"]},{"label":["outcome"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"100001","2":"1","3":"0","_rn_":"1"},{"1":"100004","2":"0","3":"0","_rn_":"2"},{"1":"100008","2":"0","3":"0","_rn_":"3"},{"1":"100012","2":"1","3":"1","_rn_":"4"},{"1":"100015","2":"0","3":"0","_rn_":"5"},{"1":"100018","2":"0","3":"0","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(basetable)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 8944    3</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>patientIds <span class="ot">&lt;-</span> basetable<span class="sc">$</span>idx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Using the above IDs, we want to identify the list of candidate empirical covariates. This list is constrained by</li>
</ol>
<ul>
<li>their prevalence (only top <code>n</code> covariates with highest prevalence would be chosen). We choose <code>n = 200</code> as it was proposed in the original algorithm. In reality, this is not necessary to be so restrictive.</li>
<li>More importantly, analysts absolutely need to get rid of the codes that have zero variance (e.g., everyone has the code, or nobody has it). This second part of the problem is more likely and addressed by the following restriction: At least <code>min_num_patients</code> number of patients need to have that code to be selected in the list.</li>
</ul>
<p>If there were more dimensions, separate list of candidate empirical covariates would be identified.</p>
<p>One important point here is that we have chosen granularity to be 3 digits in the ICD-10 code (we have already truncated the codes at 3 digit level while preparing the data).</p>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-7_f1569b680415d9023604f871c934fccf">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>step1 <span class="ot">&lt;-</span> <span class="fu">get_candidate_covariates</span>(<span class="at">df =</span> dfx,  </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">domainVarname =</span> <span class="st">"domain"</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">eventCodeVarname =</span> <span class="st">"icd10"</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">patientIdVarname =</span> <span class="st">"idx"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">patientIdVector =</span> patientIds,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n =</span> <span class="dv">200</span>, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">min_num_patients =</span> <span class="dv">20</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(eventCodeVarname, domainVarname)`</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>out1 <span class="ot">&lt;-</span> step1<span class="sc">$</span>covars_data </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["idx"],"name":[1],"type":["chr"],"align":["left"]},{"label":["icd10"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"100001","2":"dx_M79","_rn_":"1"},{"1":"100001","2":"dx_K21","_rn_":"2"},{"1":"100001","2":"dx_M79","_rn_":"3"},{"1":"100001","2":"dx_I10","_rn_":"4"},{"1":"100001","2":"dx_F32","_rn_":"5"},{"1":"100001","2":"dx_M62","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(out1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["idx"],"name":[1],"type":["chr"],"align":["left"]},{"label":["icd10"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"99997","2":"dx_K21","_rn_":"33032"},{"1":"99997","2":"dx_I99","_rn_":"33033"},{"1":"99997","2":"dx_I51","_rn_":"33034"},{"1":"99997","2":"dx_I10","_rn_":"33035"},{"1":"99997","2":"dx_I21","_rn_":"33036"},{"1":"99997","2":"dx_K59","_rn_":"33037"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(patientIds, step1<span class="sc">$</span>patientIds) <span class="co">#should return  TRUE</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assessing-recurrence-via-3-binary-variables" class="level2" data-number="H.3">
<h2 data-number="H.3" class="anchored" data-anchor-id="assessing-recurrence-via-3-binary-variables"><span class="header-section-number">H.3</span> Assessing recurrence via 3 binary variables</h2>
<p>In this step, we generate 3 binary recurrence covariates for each of the candidate empirical covariates identified in the previous step:</p>
<ul>
<li>occurred at least once</li>
<li>occurred sporadically (at least more than the median)</li>
<li>occurred frequently (at least more than the 75th percentile)</li>
</ul>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-8_0e3483f2f0d91065743610b69db70eab">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>step2 <span class="ot">&lt;-</span> <span class="fu">get_recurrence_covariates</span>(<span class="at">df =</span> out1, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">patientIdVarname =</span> <span class="st">"idx"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">eventCodeVarname =</span> <span class="st">"icd10"</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">patientIdVector =</span> patientIds)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> step2<span class="sc">$</span>recurrence_data</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out2[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["idx"],"name":[1],"type":["chr"],"align":["left"]},{"label":["rec_dx_A49_once"],"name":[2],"type":["int"],"align":["right"]},{"label":["rec_dx_A60_once"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"100001","2":"0","3":"0","_rn_":"1"},{"1":"100004","2":"0","3":"0","_rn_":"2"},{"1":"100008","2":"0","3":"0","_rn_":"3"},{"1":"100012","2":"0","3":"0","_rn_":"4"},{"1":"100015","2":"0","3":"0","_rn_":"5"},{"1":"100018","2":"0","3":"0","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(step2<span class="sc">$</span>recurrence_data)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [1] "rec_dx_A49_once"     "rec_dx_A60_once"     "rec_dx_B00_once"    </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [4] "rec_dx_B02_once"     "rec_dx_B20_once"     "rec_dx_B20_frequent"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [7] "rec_dx_B35_once"     "rec_dx_B37_once"     "rec_dx_B96_once"    </span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [10] "rec_dx_C50_once"     "rec_dx_C80_once"     "rec_dx_D75_once"    </span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [13] "rec_dx_E03_once"     "rec_dx_E04_once"     "rec_dx_E05_once"    </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [16] "rec_dx_E07_once"     "rec_dx_E28_once"     "rec_dx_E29_once"    </span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [19] "rec_dx_E78_once"     "rec_dx_E79_once"     "rec_dx_E87_once"    </span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [22] "rec_dx_F17_once"     "rec_dx_F20_once"     "rec_dx_F20_frequent"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [25] "rec_dx_F29_once"     "rec_dx_F31_once"     "rec_dx_F31_frequent"</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [28] "rec_dx_F32_once"     "rec_dx_F39_once"     "rec_dx_F41_once"    </span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [31] "rec_dx_F43_once"     "rec_dx_F90_once"     "rec_dx_G20_once"    </span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [34] "rec_dx_G20_frequent" "rec_dx_G25_once"     "rec_dx_G30_once"    </span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [37] "rec_dx_G30_frequent" "rec_dx_G31_once"     "rec_dx_G40_once"    </span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [40] "rec_dx_G43_once"     "rec_dx_G47_once"     "rec_dx_G89_once"    </span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [43] "rec_dx_H04_once"     "rec_dx_H10_once"     "rec_dx_H40_once"    </span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [46] "rec_dx_H40_frequent" "rec_dx_H57_once"     "rec_dx_H57_frequent"</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [49] "rec_dx_H66_once"     "rec_dx_I10_once"     "rec_dx_I10_frequent"</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [52] "rec_dx_I20_once"     "rec_dx_I21_once"     "rec_dx_I48_once"    </span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [55] "rec_dx_I48_frequent" "rec_dx_I49_once"     "rec_dx_I50_once"    </span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [58] "rec_dx_I50_frequent" "rec_dx_I51_once"     "rec_dx_I63_once"    </span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [61] "rec_dx_I70_once"     "rec_dx_I80_once"     "rec_dx_I99_once"    </span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [64] "rec_dx_J01_once"     "rec_dx_J02_once"     "rec_dx_J18_once"    </span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [67] "rec_dx_J20_once"     "rec_dx_J30_once"     "rec_dx_J40_once"    </span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [70] "rec_dx_J42_once"     "rec_dx_J43_once"     "rec_dx_J43_frequent"</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [73] "rec_dx_J44_once"     "rec_dx_J44_sporadic" "rec_dx_J45_once"    </span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [76] "rec_dx_J45_frequent" "rec_dx_J98_once"     "rec_dx_K04_once"    </span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [79] "rec_dx_K08_once"     "rec_dx_K21_once"     "rec_dx_K25_once"    </span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [82] "rec_dx_K27_once"     "rec_dx_K30_once"     "rec_dx_K31_once"    </span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [85] "rec_dx_K51_once"     "rec_dx_K51_frequent" "rec_dx_K58_once"    </span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [88] "rec_dx_K59_once"     "rec_dx_K76_once"     "rec_dx_K92_once"    </span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [91] "rec_dx_L08_once"     "rec_dx_L20_once"     "rec_dx_L23_once"    </span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [94] "rec_dx_L29_once"     "rec_dx_L40_once"     "rec_dx_L70_once"    </span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [97] "rec_dx_L71_once"     "rec_dx_L93_once"     "rec_dx_L93_frequent"</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [100] "rec_dx_M06_once"     "rec_dx_M10_once"     "rec_dx_M13_once"    </span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [103] "rec_dx_M19_once"     "rec_dx_M1A_once"     "rec_dx_M25_once"    </span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [106] "rec_dx_M54_once"     "rec_dx_M54_frequent" "rec_dx_M62_once"    </span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [109] "rec_dx_M79_once"     "rec_dx_M81_once"     "rec_dx_M85_once"    </span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [112] "rec_dx_N19_once"     "rec_dx_N20_once"     "rec_dx_N28_once"    </span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [115] "rec_dx_N30_once"     "rec_dx_N32_once"     "rec_dx_N39_once"    </span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [118] "rec_dx_N40_once"     "rec_dx_N42_once"     "rec_dx_N52_once"    </span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [121] "rec_dx_N92_once"     "rec_dx_N94_once"     "rec_dx_N95_once"    </span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [124] "rec_dx_R00_once"     "rec_dx_R05_once"     "rec_dx_R06_once"    </span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [127] "rec_dx_R07_once"     "rec_dx_R09_once"     "rec_dx_R10_once"    </span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [130] "rec_dx_R11_once"     "rec_dx_R12_once"     "rec_dx_R19_once"    </span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [133] "rec_dx_R21_once"     "rec_dx_R25_once"     "rec_dx_R32_once"    </span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [136] "rec_dx_R35_once"     "rec_dx_R39_once"     "rec_dx_R41_once"    </span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [139] "rec_dx_R42_once"     "rec_dx_R45_once"     "rec_dx_R51_once"    </span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [142] "rec_dx_R52_once"     "rec_dx_R60_once"     "rec_dx_R73_once"    </span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [145] "rec_dx_T14_once"     "rec_dx_T78_once"     "rec_dx_T86_once"    </span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [148] "rec_dx_T86_sporadic" "rec_dx_T86_frequent" "rec_dx_T88_once"    </span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [151] "rec_dx_Z79_once"     "rec_dx_Z95_once"</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(step2<span class="sc">$</span>recurrence_data)</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 153</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(out2)</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 8944  153</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prioritising-covariates" class="level2" data-number="H.4">
<h2 data-number="H.4" class="anchored" data-anchor-id="prioritising-covariates"><span class="header-section-number">H.4</span> Prioritising covariates</h2>
<section id="bross-formula" class="level3" data-number="H.4.1">
<h3 data-number="H.4.1" class="anchored" data-anchor-id="bross-formula"><span class="header-section-number">H.4.1</span> Bross formula</h3>
<ol type="1">
<li>Three components are used in the calculation of bias contributed by not adjusting for a covariate:</li>
</ol>
<ul>
<li>prevalence of a binary recurrence variable among exposed (<span class="math inline">\(P_{RE}\)</span>)</li>
<li>prevalence of that binary recurrence variable among unexposed (<span class="math inline">\(P_{RU}\)</span>)</li>
<li>association between that binary recurrence variable and the outcome (<span class="math inline">\(RR_{RO}\)</span>)</li>
</ul>
<p>These are the ingredients of the Bross formula. This formula is helpful for understanding the impact of unmeasured confounding of a binary variable. We have to put assumed prevalence and risk ratio associated with an unmeasured confounder.</p>
<ol start="2" type="1">
<li>These components help us calculate <span class="math inline">\(log-absolute-bias\)</span> amount:</li>
</ol>
<p><span class="math inline">\(Bias = \frac{P_{RE} (RR_{RO} - 1) + 1}{P_{RU} (RR_{RO} - 1) + 1}\)</span></p>
<p>For empirical covariates, we do not need to assume, we can basically calculate these numbers (<span class="math inline">\(log-absolute-bias\)</span>) for all of the empirical covariates. For each data dimension, we rank each of the empirical covariates based on the amount of bias (confounding or imbalance) it could likely adjust.</p>
<ol start="3" type="1">
<li>Based on this <span class="math inline">\(log-absolute-bias\)</span>, we select top <code>k</code> empirical covariates to be used in the hdPS analyses later.</li>
</ol>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-9_c3a15ee1895a8d3fc05034ddd902f7fe">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>out3 <span class="ot">&lt;-</span> <span class="fu">get_prioritised_covariates</span>(<span class="at">df =</span> out2,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">patientIdVarname =</span> <span class="st">"idx"</span>, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">exposureVector =</span> basetable<span class="sc">$</span>exposure,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">outcomeVector =</span> basetable<span class="sc">$</span>outcome,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">patientIdVector =</span> patientIds, </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">k =</span> <span class="dv">100</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(out3)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "autoselected_covariate_df" "multiplicative_bias"</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(out3<span class="sc">$</span>autoselected_covariate_df)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [1] "rec_dx_I10_once"     "rec_dx_R73_once"     "rec_dx_I10_frequent"</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [4] "rec_dx_R60_once"     "rec_dx_E78_once"     "rec_dx_M79_once"    </span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [7] "rec_dx_I51_once"     "rec_dx_I50_once"     "rec_dx_E87_once"    </span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [10] "rec_dx_K21_once"     "rec_dx_D75_once"     "rec_dx_Z79_once"    </span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [13] "rec_dx_F41_once"     "rec_dx_N28_once"     "rec_dx_M1A_once"    </span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [16] "rec_dx_M10_once"     "rec_dx_F90_once"     "rec_dx_L70_once"    </span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [19] "rec_dx_F43_once"     "rec_dx_M19_once"     "rec_dx_E79_once"    </span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [22] "rec_dx_I50_frequent" "rec_dx_B20_once"     "rec_dx_R32_once"    </span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [25] "rec_dx_F32_once"     "rec_dx_R12_once"     "rec_dx_N19_once"    </span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [28] "rec_dx_R51_once"     "rec_dx_M54_once"     "rec_dx_I80_once"    </span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [31] "rec_dx_N30_once"     "rec_dx_J45_once"     "rec_dx_B00_once"    </span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [34] "rec_dx_R07_once"     "rec_dx_I70_once"     "rec_dx_H10_once"    </span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [37] "rec_dx_T14_once"     "rec_dx_I63_once"     "rec_dx_N40_once"    </span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [40] "rec_dx_M06_once"     "rec_dx_A60_once"     "rec_dx_G89_once"    </span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [43] "rec_dx_G43_once"     "rec_dx_E28_once"     "rec_dx_F31_once"    </span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [46] "rec_dx_K31_once"     "rec_dx_H40_frequent" "rec_dx_I21_once"    </span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [49] "rec_dx_I48_once"     "rec_dx_N92_once"     "rec_dx_M13_once"    </span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [52] "rec_dx_J98_once"     "rec_dx_M81_once"     "rec_dx_R21_once"    </span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [55] "rec_dx_G47_once"     "rec_dx_R35_once"     "rec_dx_H40_once"    </span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [58] "rec_dx_T78_once"     "rec_dx_M85_once"     "rec_dx_L29_once"    </span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [61] "rec_dx_G31_once"     "rec_dx_B02_once"     "rec_dx_T86_once"    </span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [64] "rec_dx_R52_once"     "rec_dx_G25_once"     "rec_dx_J20_once"    </span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [67] "rec_dx_M54_frequent" "rec_dx_R42_once"     "rec_dx_T86_sporadic"</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [70] "rec_dx_I49_once"     "rec_dx_I20_once"     "rec_dx_E07_once"    </span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [73] "rec_dx_J30_once"     "rec_dx_K92_once"     "rec_dx_E03_once"    </span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [76] "rec_dx_K08_once"     "rec_dx_J02_once"     "rec_dx_K51_frequent"</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [79] "rec_dx_H57_frequent" "rec_dx_G30_frequent" "rec_dx_J40_once"    </span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [82] "rec_dx_J42_once"     "rec_dx_C80_once"     "rec_dx_B96_once"    </span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [85] "rec_dx_G20_frequent" "rec_dx_I99_once"     "rec_dx_Z95_once"    </span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [88] "rec_dx_T88_once"     "rec_dx_H66_once"     "rec_dx_K58_once"    </span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [91] "rec_dx_F17_once"     "rec_dx_N95_once"     "rec_dx_R39_once"    </span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [94] "rec_dx_R25_once"     "rec_dx_K30_once"     "rec_dx_R05_once"    </span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [97] "rec_dx_L08_once"     "rec_dx_F39_once"     "rec_dx_B37_once"    </span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [100] "rec_dx_N94_once"</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>out3<span class="sc">$</span>autoselected_covariate_df<span class="sc">$</span>rec_dx_NA_once <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>out3<span class="sc">$</span>autoselected_covariate_df<span class="sc">$</span>rec_dx_NA_sporadic <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>out3<span class="sc">$</span>autoselected_covariate_df<span class="sc">$</span>rec_dx_NA_frequent <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(out3<span class="sc">$</span>autoselected_covariate_df)</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 8944  101</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out3<span class="sc">$</span>autoselected_covariate_df[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["idx"],"name":[1],"type":["chr"],"align":["left"]},{"label":["rec_dx_I10_once"],"name":[2],"type":["int"],"align":["right"]},{"label":["rec_dx_R73_once"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"100001","2":"1","3":"0","_rn_":"1"},{"1":"100004","2":"1","3":"0","_rn_":"2"},{"1":"100008","2":"1","3":"0","_rn_":"3"},{"1":"100012","2":"1","3":"0","_rn_":"4"},{"1":"100015","2":"0","3":"0","_rn_":"5"},{"1":"100018","2":"0","3":"0","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="investigate-log-absolute-bias" class="level3" data-number="H.4.2">
<h3 data-number="H.4.2" class="anchored" data-anchor-id="investigate-log-absolute-bias"><span class="header-section-number">H.4.2</span> Investigate log-absolute-bias</h3>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-10_3d38f0f4d7532a4deedc024f9defa725">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(out3<span class="sc">$</span>multiplicative_bias)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 152</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out3<span class="sc">$</span>multiplicative_bias)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.000325  0.018752  0.053685  0.346664  0.125403 10.695535</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(out3<span class="sc">$</span>multiplicative_bias[out3<span class="sc">$</span>multiplicative_bias <span class="sc">&gt;</span> <span class="fl">0.0001</span>])</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 128</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(out3<span class="sc">$</span>multiplicative_bias[out3<span class="sc">$</span>multiplicative_bias <span class="sc">&gt;</span> <span class="fl">0.001</span>])</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 50</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(out3<span class="sc">$</span>multiplicative_bias[out3<span class="sc">$</span>multiplicative_bias <span class="sc">&gt;</span> <span class="fl">0.01</span>])</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(out3<span class="sc">$</span>multiplicative_bias[out3<span class="sc">$</span>multiplicative_bias <span class="sc">&gt;</span> <span class="fl">0.1</span>])</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(out3<span class="sc">$</span>multiplicative_bias)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hdPSinMerged_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="save-all-data" class="level2" data-number="H.5">
<h2 data-number="H.5" class="anchored" data-anchor-id="save-all-data"><span class="header-section-number">H.5</span> Save all data</h2>
<section id="analytic-data-1" class="level3" data-number="H.5.1">
<h3 data-number="H.5.1" class="anchored" data-anchor-id="analytic-data-1"><span class="header-section-number">H.5.1</span> Analytic data</h3>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-11_d179278142b960312f1b0efb8824d45b">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>analytic<span class="sc">$</span>idx <span class="ot">&lt;-</span> analytic<span class="sc">$</span>id</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>analytic<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(analytic)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 16091    34</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># profile_missing(analytic)</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>analyticvar.names0 <span class="ot">&lt;-</span> <span class="fu">names</span>(analytic)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>analyticvar.names <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(analyticvar.names0, <span class="fu">c</span>(<span class="st">"age"</span>, </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"diabetes"</span>, </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"pregnancy"</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"obese"</span>, </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"survey.weight"</span>, </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"survey.weight.mec"</span>, </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"psu"</span>, </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"strata"</span>, </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"year"</span>, </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"idx"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-12_103a35f903245166a880a8c6c9c7b669">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(analytic, analyticvar.names, <span class="at">file =</span> <span class="st">"data/analyticData.RData"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-with-empirical-covariates" class="level3" data-number="H.5.2">
<h3 data-number="H.5.2" class="anchored" data-anchor-id="data-with-empirical-covariates"><span class="header-section-number">H.5.2</span> Data with empirical covariates</h3>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-13_bf7257f4ef55e5909b03a6ac9b73b3cc">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>emp.cov.dim <span class="ot">&lt;-</span> step2<span class="sc">$</span>recurrence_data</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>emp.codes <span class="ot">&lt;-</span> <span class="fu">names</span>(step2<span class="sc">$</span>recurrence_data)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>emp.cov.data <span class="ot">&lt;-</span> <span class="fu">merge</span>(analytic, emp.cov.dim, <span class="at">by =</span> <span class="st">"idx"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># profile_missing(emp.cov.data)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>emp.cov.data[<span class="fu">is.na</span>(emp.cov.data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># profile_missing(emp.cov.data)</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(emp.cov.data)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 16091   186</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>emp.cov.names <span class="ot">&lt;-</span> <span class="fu">names</span>(step2<span class="sc">$</span>recurrence_data)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">apply</span>(emp.cov.data[,emp.cov.names], <span class="dv">2</span>, sum))[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; rec_dx_K51_frequent rec_dx_B20_frequent rec_dx_G30_frequent rec_dx_L93_frequent </span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   7                   9                   9                  10 </span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; rec_dx_F20_frequent rec_dx_G20_frequent rec_dx_T86_frequent rec_dx_H57_frequent </span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                  11                  11                  12                  15 </span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; rec_dx_J43_frequent     rec_dx_A60_once </span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                  15                  21</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-14_bb9c9d8d801a54159cfb258dd6e221e5">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(emp.cov.names, emp.cov.data, <span class="at">file =</span> <span class="st">"data/EmpCovData.RData"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-with-hdps-covariates" class="level3" data-number="H.5.3">
<h3 data-number="H.5.3" class="anchored" data-anchor-id="data-with-hdps-covariates"><span class="header-section-number">H.5.3</span> Data with hdPS covariates</h3>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-15_3735d86eb2d0b39d7de5bf10a92f6146">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>hdps.dim <span class="ot">&lt;-</span> out3<span class="sc">$</span>autoselected_covariate_df</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>hdps.data <span class="ot">&lt;-</span> <span class="fu">merge</span>(analytic, hdps.dim, <span class="at">by =</span> <span class="st">"idx"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># profile_missing(hdps.data)</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>hdps.data[<span class="fu">is.na</span>(hdps.data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># profile_missing(hdps.data)</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(hdps.data)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 16091   134</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>hdps.names <span class="ot">&lt;-</span> <span class="fu">names</span>(out3<span class="sc">$</span>autoselected_covariate_df)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">apply</span>(hdps.data[,hdps.names], <span class="dv">2</span>, sum))[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; rec_dx_K51_frequent rec_dx_G30_frequent rec_dx_G20_frequent rec_dx_H57_frequent </span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   7                   9                  11                  15 </span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     rec_dx_A60_once rec_dx_T86_sporadic     rec_dx_J02_once     rec_dx_H66_once </span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                  21                  23                  24                  24 </span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     rec_dx_M85_once     rec_dx_B02_once </span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                  25                  25</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="hdPSinMerged_cache/html/unnamed-chunk-16_97abbe67871e6d1d197c058d06918729">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(hdps.names, hdps.data, <span class="at">file =</span> <span class="st">"data/hdPSData.RData"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./merge13to17.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Merge NHANES 2013-2018 datasets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./labModified.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Preparing data with modified Lab variables</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>